<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pay with Crypto (NOWPayments) — Simple</title>
  <style>
    /* Simple, clean styling for beginners */
    body { font-family: system-ui, Arial, sans-serif; background:#f6f8fb; color:#111; display:flex; align-items:center; justify-content:center; height:100vh; margin:0; }
    .card { background:#fff; padding:24px; border-radius:12px; width:380px; box-shadow:0 8px 24px rgba(15,20,40,0.08); }
    h1 { font-size:18px; margin:0 0 12px; }
    label { display:block; font-size:13px; margin-top:12px; color:#444; }
    input[type="number"], input[type="text"], select, textarea {
      width:100%; padding:10px 12px; border:1px solid #e1e6ef; border-radius:8px; margin-top:6px; box-sizing:border-box;
    }
    .row { display:flex; gap:8px; }
    button { margin-top:16px; width:100%; padding:12px; border-radius:10px; border:none; background:#4f9cff; color:white; font-weight:600; cursor:pointer; }
    .muted { color:#6b7280; font-size:13px; margin-top:8px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Pay with Crypto (NOWPayments)</h1>

    <label for="amount">Amount</label>
    <input id="amount" type="number" min="0.01" step="0.01" placeholder="Type any amount (e.g. 49.99)" value="26.78" />

    <label for="currency">Fiat currency</label>
    <select id="currency">
      <option value="usd">USD</option>
      <option value="eur">EUR</option>
      <option value="gbp">GBP</option>
      <option value="ngn">NGN</option>
      <!-- add more if you want -->
    </select>

    <label for="description">Description (optional)</label>
    <input id="description" type="text" placeholder="Order description (e.g. donation)" />

    <label style="margin-top:10px;">
      <input id="fixedRate" type="checkbox" checked /> Fixed rate (locks crypto amount at creation)
    </label>

    <div id="status" class="muted">Minimum payment amount is enforced by the gateway.</div>

    <button id="payBtn">Pay with Crypto</button>

    <div id="result" class="muted" style="display:none; margin-top:10px;"></div>
  </div>

<script>
  const payBtn = document.getElementById('payBtn');
  const status = document.getElementById('status');
  const result = document.getElementById('result');

  payBtn.addEventListener('click', async () => {
    result.style.display = 'none';
    const amount = parseFloat(document.getElementById('amount').value);
    const currency = document.getElementById('currency').value;
    const description = document.getElementById('description').value || 'Payment';
    const isFixed = document.getElementById('fixedRate').checked;

    if (!amount || amount <= 0) {
      alert('Please enter a valid amount greater than 0.');
      return;
    }

    payBtn.disabled = true;
    payBtn.textContent = 'Creating payment...';

    try {
      // Call your server-side endpoint that creates an invoice with NOWPayments
      const res = await fetch('/create-payment', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          price_amount: amount,
          price_currency: currency,
          order_description: description,
          is_fixed_rate: isFixed
        })
      });

      if (!res.ok) {
        const err = await res.json().catch(()=>({message:'Unknown server error'}));
        throw new Error(err.message || 'Server error');
      }

      const data = await res.json();
      // NOWPayments returns invoice_url — redirect the user to complete the payment.
      if (data.invoice_url) {
        // Option A: redirect in same tab
        window.location.href = data.invoice_url;
        // Option B: open in new tab
        // window.open(data.invoice_url, '_blank');
      } else {
        throw new Error('No invoice_url returned from server.');
      }
    } catch (e) {
      result.style.display = 'block';
      result.textContent = 'Error: ' + e.message;
      payBtn.disabled = false;
      payBtn.textContent = 'Pay with Crypto';
    }
  });
</script>
</body>
</html>
